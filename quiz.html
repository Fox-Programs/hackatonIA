<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8" />
    <title>Quiz Anti-Gaspi</title>
    <link rel="stylesheet" href="style.css" />
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f8f5;
            padding: 2em;
            text-align: center;
        }

        #question {
            font-size: 1.5em;
            margin-bottom: 20px;
        }

        #answers {
            list-style-type: none;
            padding: 0;
        }

        #answers li {
            background-color: #4caf50;
            color: white;
            padding: 12px;
            margin: 10px auto;
            width: 80%;
            max-width: 400px;
            border-radius: 10px;
            font-size: 1.1em;
            transition: transform 0.2s;
            cursor: pointer;
        }

        #answers li:hover {
            background-color: #388e3c;
            transform: scale(1.05);
        }

        #wait-message {
            color: #777;
            font-style: italic;
        }
    </style>
</head>

<body>
    <main>
        <h2>üì± Quiz Anti-Gaspi</h2>
        <div id="question-container">
            <p id="question"></p>
            <ul id="answers"></ul>
        </div>
        <p id="wait-message">‚è≥ En attente du lancement du quiz...</p>
        <p id="final-score" style="display: none;"></p>
    </main>

    <script src="data.js"></script>
    <script src="quiz.js"></script>
    <script>
        const questionElem = document.getElementById("question");
        const answersElem = document.getElementById("answers");
        const waitMsg = document.getElementById("wait-message");
        const finalScoreElem = document.getElementById("final-score");
        let currentIndex = 0;
        let userAnswers = [];

        // Affichage des questions et r√©ponses
        function displayQuestion(index) {
            if (index === -1) {
                showFinalScore();
                return;
            }

            const q = quiz[index];
            waitMsg.style.display = "none";
            questionElem.textContent = q.question;
            answersElem.innerHTML = "";

            q.options.forEach((option, i) => {
                const li = document.createElement("li");
                li.textContent = option;
                li.onclick = () => {
                    handleAnswer(i);
                    li.style.backgroundColor = "#ccc"; // Visuel r√©ponse s√©lectionn√©e
                };
                answersElem.appendChild(li);
            });
        }

        // Gestion de la r√©ponse de l'utilisateur
        function handleAnswer(selectedIndex) {
            userAnswers[currentIndex] = selectedIndex; // Sauvegarde de la r√©ponse
            currentIndex++;
            localStorage.setItem("quiz_index", currentIndex.toString());
        }

        // Affichage du score final √† la fin du quiz
        function showFinalScore() {
            let score = 0;
            quiz.forEach((q, i) => {
                if (userAnswers[i] === q.answer) {
                    score++;
                }
            });

            finalScoreElem.style.display = "block";
            finalScoreElem.textContent = `Votre score : ${score} / ${quiz.length}`;
            localStorage.setItem("quiz_started", "false");
            localStorage.setItem("quiz_index", "0");
            saveScore(score);
        }

        // Sauvegarde du score dans localStorage
        function saveScore(score) {
            const scores = JSON.parse(localStorage.getItem("scores") || "[]");
            scores.push(score);
            localStorage.setItem("scores", JSON.stringify(scores));
        }

        listenToChanges(displayQuestion);
    </script>
</body>

</html>
